import gzip
import subprocess


def gzip_decompress(org_data):
    de_data = gzip.decompress(org_data)
    print(de_data.hex())
    return de_data


def de_proto(pf_data):
    process = subprocess.Popen([r'E:\protoc-3.12.3-win64\bin\protoc.exe', '--decode_raw'],
                               stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    output = error = None
    try:
        output, error = process.communicate(pf_data)
    except OSError:
        pass
    finally:
        if process.poll() != 0:
            process.wait()
    return output


if __name__ == '__main__':
    # data = '31303534202020203120202036201f8b08000000000000009d54db6ee33610dde6d2a66e1f5a77f7a54f8650f4b258dba4eeb2a116be6cda20c9aebb71b0e8d6054153b4454796b422edd809f253fd95fe504794d30d8af4a57a10c4333347c33987b4116e1cedd5f72cf3eb3d848d27cf9f5a264218a3c0c4c874b1675bd871cca716f2cdfef654aa1ec2fdd5d2bab951bcf3896fda2d8450ffc0b63cebcd51e0a0f2c1efbec42e0eb06db99e1de020f01c7ffa64f1acf6714ee7fc24aa7ff60dcd7392d055cae2c577b5fdb588ea8d81fbd2f4f031ea594317e397fd001ff7bcc1d0c743a76f07cef1a2563bc8cbcc3d132f8e6afb123e3fc28b1f6b079be68ad6dd75b8eb866432eca5519189083ed7614096e1486c78d2b0c8b4a06914ceb36c9e70b29e8768f155ed7399a97cb02a0a9eb26d7d7ff0ea37006b257896319af0fae14ddc1cbc5a7c51816ff85c64697d0f907aedd312f9b9c85679fd90a942e48ba0f68c65cb659692394f89cc45c40bb28c9c7a83238ca61e0cd475a81531844dcbf7f8d4f503ca2c87b2e228d83db5bf0e6f0d966557824ba36390943011858f09d36d4845d54a92292d48ccc53c56a1eb761b114fa550dbd06c79650e2b3834732d22158718f9c87861c49c426725fdedc4e831c67335313a1303944904a30af6d85ec82c9d182f26c6204b154f5573bccdf9a3595d16d3427215aed4ace9eb9a4bc98b660f8650f10e69b216576db3855ba8f1fd9948579b6ee3b2dbd829d508ba8d9d488dfe4a24517bf4abd56be100ba850a64fe4006e57c7ba311b917d76f95821318a15d05abf75b51f0844b791f6743be168cffe30176216e78785dcee1796c22d327e4ff79875cbceefd321e8ff4764121bdcfc754d2099b26539be6bdcf742e58ed4148db48e3da490f22950f75485bf141a872e38e6d62dc81b24baee22c026147af2fc6b05e15092c62a572d969b7972dcdde0293b60b0eeec9455b66d46c63d7b5bdf69cab5e7f0cf8902ada2aa5fd8990f93501c1c182f706fd56636b5edccfad023e0caf5ae70955b3ac5886a09a7157fff3e0b634ce49d9db3d13f4c7120126391902fad8f020836ff24116e9b3b073aed1d154e25f5474a5e22a89e9d07ff031955d4194f933c7e3369bcd2c97ce6cbb8cc09e20b2db1500094de700c0d5f8c2901fe8a5a62f6fbd72b1950cdad3ff33eeca1aa92ef3882a3e16cb12069361649b160a1ccff1ca8a159c1fbe846d9f09a98cceef065c97189be4e47c40d88cbe871cb0be03decc544c52384a790579c8d749e29aa64a4318614743799ca57c578802324b22b2d8c4d3082018836521d2efbf232cce967c07618b9c9f8ec9e968303a2f0b7de44056f9c72295d7a2e272a18992ab48ccf77207614c441a9138677247854ccd1ee5db58334157ae664aa6524326dc772626c76763a2365ba999bc5219cd04596989383084aa4e162c36feb8fb1bb1455a3ca0060000'
    # data = bytes.fromhex(data)
    # data = gzip_decompress(data[14:])
    # print(data)
    # lens = int(data[:4])
    # print(lens)
    # print(data[4:lens+4].hex())
    # data = de_proto(data[4:lens+4])
    # print(data.decode())
    data = '0ac4014012581272bd01229f01088894bd042209e5be90e9be99e8b1a13a8c017b226275666673223a22222c226870223a3530302c226a757374696365223a302c226c6576656c223a312c226d61786870223a3530302c226d61786d70223a3231302c226d70223a3231302c22706f736974696f6e223a22222c2273656374223a313031392c22736578223a312c227374617465223a302c227469746c65223a22222c2274797065223a307d3801421768656c6c6f2068656c6c6f2068656c6c6f2068656c6c6f200528fb07'
    data = bytes.fromhex(data)
    data = de_proto(data)
    print(data.decode())
